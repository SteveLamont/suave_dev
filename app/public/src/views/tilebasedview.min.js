PivotViewer.Views.TileBasedView=PivotViewer.Views.IPivotViewerView.subClass({init:function(){this._super();var t=this;$.subscribe("/PivotViewer/Views/Canvas/Drag",function(e){if(t.isActive){var i=e.x,r=e.y;i>0&&t.currentOffsetX>t.offsetX?i=0:t.currentOffsetX<t.offsetX&&t.currentWidth==t.width?i=0:i<0&&t.currentOffsetX<-t.currentWidth+t.width?i=0:t.currentOffsetX+=i,r>0&&t.currentOffsetY+t.canvasHeightUIAdjusted>t.currentHeight+t.offsetY?r=0:t.currentOffsetY<t.offsetY&&t.currentHeight==t.height?r=0:r<0&&t.currentOffsetY-t.offsetY<-t.currentHeight+t.height?r=0:t.currentOffsetY+=r,0==i&&0==r||t.offsetTiles(i,r)}})},_findFilteredItem:function(t){var e=-1;if("init"==t.type)for(var i=0;i<this.filterList.length;i++){var r=this.filterList[i].item.id;if(r==t.id){e=i;break}}else for(var i=0;i<this.filterList.length;i++){var r=this.filterList[i].contains(t.x,t.y);if(r>=0){e=i;break}}return e},super_handleClick:function(t){var e=this._findFilteredItem(t);return e<0?null:this.filterList[e]},handleClick:function(t){return this.super_handleClick(t)},super_handleDoubleClick:function(t){var e=this._findFilteredItem(t);return e<0?null:this.filterList[e]},handleDoubleClick:function(t){return this.super_handleClick(t)},super_handleHover:function(t){if(null==this.selected)for(var e=0;e<this.filterList.length;e++){var i=this.filterList[e].contains(t.x,t.y);i>=0?this.filterList[e].setSelected(!0):this.filterList[e].setSelected(!1)}},handleHover:function(t){this.super_handleHover(t)},activate:function(){this._super(),$(".pv-toolbarpanel-zoomslider").fadeIn(),$(".pv-toolbarpanel-zoomcontrols").css("border-width","1px"),$(".pv-toolbarpanel-zoomcontrols").show(),$("#MAIN_BODY").css("overflow","auto"),$(".pv-toolbarpanel-sort").fadeIn(),$(".pv-canvas").fadeIn()},deactivate:function(){this._super(),$(".pv-toolbarpanel-zoomslider").fadeOut(),$(".pv-toolbarpanel-sort").fadeOut(),$(".pv-canvas").fadeOut()},offsetTiles:function(t,e){for(var i=0;i<this.filterList.length;i++)for(var r=this.filterList[i]._locations,s=0;s<r.length;s++)r[s].destinationx+=t,r[s].destinationy+=e},calculateDimensions:function(t,e,i,r){var s=i*(r-.81),n=.9*(e+t*i),o=e*t*-1,l=Math.floor((-1*n+Math.sqrt(n*n-4*s*o))/(2*s)),a=Math.floor(l*i);a<3&&(tileWidth=a=3);var f=Math.floor(e/a),h=t>l?Math.floor(t/l):1;return{Rows:f,Columns:h,TileMaxWidth:l,TileHeight:a,PaddingX:Math.ceil(t-h*l),PaddingY:Math.ceil(e-f*a)}},getTileDimensions:function(t,e,i,r,s){var n=t/s.Columns,o=Math.floor(n*i),l=Math.ceil(t-s.Columns*n),a=Math.ceil(e-s.Rows*o);return{Rows:s.Rows,Columns:s.Columns,TileMaxWidth:n,TileHeight:o,PaddingX:l,PaddingY:a}}});